# AlphaHack

Часть 1: Разработка модели прогнозирования дохода
Поскольку целевая метрика — WMAE (Weighted Mean Absolute Error), нам нужно понять, как задаются веса. Обычно в таких задачах вес зависит от величины самого дохода (например, чтобы точнее предсказывать доходы VIP-клиентов) или от сегмента клиента. Предположим, что веса обратно пропорциональны частоте встречаемости дохода в определенном диапазоне (для балансировки вклада разных групп) или прямо пропорциональны фактическому доходу (чтобы минимизировать ошибки для более крупных сумм). Это критически важный момент, который нужно уточнить у заказчика.



Пошаговый план:

1. Предобработка и исследование данных (EDA)
Анализ целевой переменной (income):

Построим гистограмму, ящик с усами. Скорее всего, распределение будет скошенным (логарифмически нормальным).

Проверим на наличие выбросов и аномалий (нулевые или отрицательные доходы, нереально высокие значения).

Работа с признаками:

Категориальные: Пол, семейное положение, образование, тип занятости, отрасль и т.д. Закодируем их с помощью One-Hot Encoding или Target Encoding (если категорий много).

Числовые: Возраст, количество детей, стаж работы и т.д. Масштабируем (StandardScaler или RobustScaler).

Временные: Дату рождения преобразуем в возраст.

Пропуски: Для числовых признаков используем медиану, для категориальных — моду или специальную категорию "unknown".

Анализ мультиколлинеарности: Построим тепловую карту корреляций и, при необходимости, удалим сильно скоррелированные признаки.

Генерация признаков (Feature Engineering):

Создание новых признаков часто дает большой прирост. Например:

age_group (молодой, средний, предпенсионный, пенсионный).

work_experience_to_age_ratio (стаж к возрасту).

has_children (бинарный признак).

loan_balance_to_income_ratio (если есть данные о текущих кредитах).

is_high_education (объединение высших степеней образования).

## Задача по оптимизации портфеля
Возмомно будет стоять задача по оптимизации портфеля, а именно стремление к равенству денег, которых мы получаем от хороших заёмшиков к потенциальным потерям от плохих заёмщиков. Из этого соотношения и будем брать процентную ставку

2. Выбор и обучение модели
Мы будем использовать ансамблевые методы, которые хорошо показывают себя на табличных данных.

Базовые модели:

LinearRegression (как бейзлайн)

RandomForestRegressor

GradientBoostingRegressor (XGBoost, LightGBM, CatBoost)

Ключевой момент для WMAE: Чтобы минимизировать взвешенную ошибку, мы можем передать веса непосредственно в модель при обучении. Не все алгоритмы поддерживают это. LightGBM и XGBoost имеют параметр sample_weight, что позволяет напрямую оптимизировать под WMAE.

Пример для LightGBM:

python
import lightgbm as lgb

# Предположим, у нас есть веса для каждого наблюдения (weights)
train_data = lgb.Dataset(X_train, y_train, weight=weights_train)

params = {
    'objective': 'regression_l1',  # Используем MAE как базовую функцию потерь
    'metric': 'mae',
    'boosting_type': 'gbdt',
    'num_leaves': 31,
    'learning_rate': 0.05,
    'feature_fraction': 0.9
}

model = lgb.train(params, train_data, num_boost_round=1000)
Если модель не поддерживает веса, можно применить стратификацию при разбиении на выборки или использовать методы ресэмплинга (например, SMOTE для регрессии), чтобы "уравнять" вклад разных групп в функцию потерь.

3. Валидация и тонкая настройка
Разбиение данных: Стратифицированное разбиение на тренировочную, валидационную и тестовую выборки. Стратификацию лучше проводить по бинам дохода, чтобы распределение дохода было схожим во всех выборках.

Кросс-валидация: Проведем кросс-валидацию с учетом весов для более надежной оценки.

Подбор гиперпараметров: Используем Optuna или GridSearchCV (с поддержкой весов) для поиска оптимальных параметров модели. Фокусируемся на минимизации WMAE на валидационной выборке.

Итог по модели: Скорее всего, лучший результат покажет LightGBM или CatBoost, так как они эффективно работают с категориальными признаками и позволяют использовать веса для обучения.

Часть 2: Формат применения модели — Сервис "Персональный Финансовый Консультант"
Предлагаю создать веб-сервис для внутреннего использования сотрудниками банка (в кол-центре, в отделениях) и для интеграции в клиентские приложения (например, в "Альфа-Мобайл").

Название: Alpha-Income Advisor

Архитектура сервиса:
Backend: Python (FastAPI или Django), который загружает обученную модель (pickle или native format LightGBM) и предоставляет REST API.

Frontend: React.js или внутренний интерфейс в рамках CRM-системы банка.

База данных: Хранилище с актуальными профилями клиентов.

Сервис генерации предложений: Логический модуль, который на основе прогноза дохода и других данных клиента формирует персональные предложения.

Сценарии использования и интерфейсы:
Сценарий 1: Для сотрудника кол-центра / менеджера отделения

Интерфейс: Поиск клиента по ID/телефону/ФИО.

Дашборд: После выбора клиента система в реальном времени отображает:

Основные данные: Возраст, занятость, текущие продукты.

Ключевой показатель: "Прогнозируемый ежемесячный доход" (с доверительным интервалом, например, 45 000 - 55 000 руб.).

Расчет ПДН (Предельной Долговой Нагрузки):

Текущий ПДН: На основе текущих платежей и прогнозируемого дохода.

ПДН после одобрения заявки: Как изменится нагрузка, если выдать запрашиваемый кредит.

Визуализация: Цветовая индикация (зеленый - низкий ПДН, желтый - средний, красный - превышение лимита ЦБ).

Блок "Персональные предложения":

Кредитные карты: Автоматически рассчитанный и предзаполненный лимит с выгодной ставкой.

Кредиты наличными: Рекомендуемая сумма и срок, при которых ПДН клиента остается в безопасной зоне.

Инвестиционные идеи: Предложение открыть ИИС или начать инвестировать в ПИФы, если у клиента высокий прогнозируемый доход и нет активных инвестиций.

Сберегательные счета: Предложение с повышенной ставкой для "свободных" денег.

Сценарий 2: Для клиента в мобильном приложении "Альфа-Мобайл"

Раздел: "Ваши финансовые возможности" или "Персональные предложения".

Интерфейс: Более простой и мотивационный.

"На основе ваших данных, мы подготовили для вас специальные условия":

"Вам одобрена кредитная карта с лимитом до 300 000 руб." -> Кнопка "Получить"

"Хотите более выгодные условия? Вам доступен кредит на 500 000 руб. по ставке 8.9%" -> Кнопка "Узнать подробнее"

Опция "Улучшить свои условия": Клиенту предлагается обновить информацию о работе или доходе (например, загрузить справку 2-НДФЛ), чтобы получить еще более выгодные предложения. Это также помогает собирать новые данные для дообучения модели.

Преимущества данного формата:
Повышение конверсии: Менеджер получает готовый скрипт для разговора и аргументированные предложения.

Снижение рисков: Контроль ПДН в режиме реального времени помогает соблюдать требования ЦБ и снижает долю плохих кредитов.

Улучшение клиентского опыта: Клиенты чувствуют заботу и персональный подход, получая релевантные предложения без лишних заявок.

Data-Driven Approach: Сервис постоянно учится на новых данных, и его прогнозы со временем становятся только точнее.